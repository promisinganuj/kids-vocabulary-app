<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recent Words - Vocabulary App</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .word-card {
            border-left: 4px solid #007bff;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
        }
        .word-card:hover {
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }
        .mastery-badge {
            font-size: 0.8rem;
            padding: 0.25rem 0.5rem;
        }
        .mastery-learning { background-color: #ffc107; color: #000; }
        .mastery-practicing { background-color: #17a2b8; color: #fff; }
        .mastery-confident { background-color: #28a745; color: #fff; }
        .mastery-mastered { background-color: #6c757d; color: #fff; }
        .progress-ring {
            display: inline-block;
            width: 30px;
            height: 30px;
            margin-right: 10px;
        }
        .progress-ring circle {
            stroke-width: 3;
            fill: transparent;
            r: 12;
            cx: 15;
            cy: 15;
        }
        .progress-ring .background {
            stroke: #e9ecef;
        }
        .progress-ring .progress {
            stroke: #007bff;
            stroke-linecap: round;
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
            transition: stroke-dasharray 0.3s ease;
        }
        .stats-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }
    </style>
</head>
<body class="bg-light">
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="/"><i class="fas fa-book-open"></i> Vocabulary App</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/flashcards">Flashcards</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/ai-learning">AI Learning</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/manage">Manage Words</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="/recent">Recent Words</a>
                    </li>
                </ul>
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="/profile"><i class="fas fa-user"></i> Profile</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/api/auth/logout"><i class="fas fa-sign-out-alt"></i> Logout</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row">
            <div class="col-12">
                <div class="stats-card">
                    <div class="row align-items-center">
                        <div class="col-md-8">
                            <h1 class="mb-1"><i class="fas fa-clock"></i> Recent Words</h1>
                            <p class="mb-0">Words you've studied in the last 7 days</p>
                        </div>
                        <div class="col-md-4 text-end">
                            <div class="btn-group" role="group">
                                <button type="button" class="btn btn-light btn-sm" onclick="loadRecentWords(3)">3 Days</button>
                                <button type="button" class="btn btn-outline-light btn-sm active" onclick="loadRecentWords(7)">7 Days</button>
                                <button type="button" class="btn btn-outline-light btn-sm" onclick="loadRecentWords(14)">14 Days</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-12">
                <div id="recent-words-container">
                    {% if recent_words %}
                        <div class="row">
                            {% for word_data in recent_words %}
                            <div class="col-md-6 col-lg-4 mb-3">
                                <div class="card word-card h-100">
                                    <div class="card-body">
                                        <div class="d-flex justify-content-between align-items-start mb-2">
                                            <h5 class="card-title mb-0">{{ word_data.word }}</h5>
                                            <span class="badge mastery-{{ word_data.mastery_level_name.lower() }} mastery-badge">
                                                {{ word_data.mastery_level_name }}
                                            </span>
                                        </div>
                                        
                                        <p class="card-text text-muted mb-2">{{ word_data.definition }}</p>
                                        
                                        <div class="d-flex align-items-center mb-2">
                                            <svg class="progress-ring">
                                                <circle class="background" />
                                                <circle class="progress" style="stroke-dasharray: {{ (word_data.mastery_level / 3 * 75.4)|round(1) }} 75.4;" />
                                            </svg>
                                            <small class="text-muted">
                                                Reviewed {{ word_data.review_count }} time{{ 's' if word_data.review_count != 1 else '' }}
                                            </small>
                                        </div>
                                        
                                        <div class="d-flex justify-content-between align-items-center">
                                            <small class="text-muted">
                                                <i class="fas fa-calendar"></i> 
                                                Last: {{ word_data.last_reviewed_date }}
                                            </small>
                                            <div class="btn-group btn-group-sm">
                                                <button class="btn btn-outline-primary btn-sm" onclick="reviewWord('{{ word_data.word }}')">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                                <button class="btn btn-outline-success btn-sm" onclick="practiceWord('{{ word_data.word }}')">
                                                    <i class="fas fa-dumbbell"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <div class="text-center py-5">
                            <i class="fas fa-clock text-muted" style="font-size: 4rem;"></i>
                            <h3 class="mt-3 text-muted">No Recent Activity</h3>
                            <p class="text-muted">You haven't studied any words in the last 7 days.</p>
                            <div class="mt-4">
                                <a href="/flashcards" class="btn btn-primary me-2">
                                    <i class="fas fa-cards-blank"></i> Start Flashcards
                                </a>
                                <a href="/ai-learning" class="btn btn-outline-primary">
                                    <i class="fas fa-brain"></i> AI Learning
                                </a>
                            </div>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="fas fa-bolt"></i> Quick Actions</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-4 mb-2">
                                <button class="btn btn-success w-100" onclick="loadAchievements()">
                                    <i class="fas fa-trophy"></i> View Achievements
                                </button>
                            </div>
                            <div class="col-md-4 mb-2">
                                <button class="btn btn-info w-100" onclick="loadInsights()">
                                    <i class="fas fa-chart-line"></i> Study Insights
                                </button>
                            </div>
                            <div class="col-md-4 mb-2">
                                <a href="/ai-learning" class="btn btn-primary w-100">
                                    <i class="fas fa-brain"></i> Start AI Session
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <!-- Achievements Modal -->
    <div class="modal fade" id="achievementsModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-trophy"></i> Your Achievements</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="achievements-content">
                    <div class="text-center">
                        <i class="fas fa-spinner fa-spin fa-2x"></i>
                        <p class="mt-2">Loading achievements...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Insights Modal -->
    <div class="modal fade" id="insightsModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-chart-line"></i> Study Insights</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="insights-content">
                    <div class="text-center">
                        <i class="fas fa-spinner fa-spin fa-2x"></i>
                        <p class="mt-2">Loading insights...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let achievementsModal, insightsModal;

        document.addEventListener('DOMContentLoaded', function() {
            achievementsModal = new bootstrap.Modal(document.getElementById('achievementsModal'));
            insightsModal = new bootstrap.Modal(document.getElementById('insightsModal'));
        });

        function loadRecentWords(days) {
            // Update active button
            document.querySelectorAll('.btn-group .btn').forEach(btn => {
                btn.classList.remove('active');
                btn.classList.add('btn-outline-light');
            });
            event.target.classList.add('active');
            event.target.classList.remove('btn-outline-light');
            event.target.classList.add('btn-light');

            // Load words for selected period
            fetch(`/api/user/recent-words?days=${days}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        updateRecentWordsDisplay(data.recent_words);
                    } else {
                        console.error('Failed to load recent words:', data.error);
                    }
                })
                .catch(error => {
                    console.error('Error loading recent words:', error);
                });
        }

        function updateRecentWordsDisplay(words) {
            const container = document.getElementById('recent-words-container');
            
            if (words.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-5">
                        <i class="fas fa-clock text-muted" style="font-size: 4rem;"></i>
                        <h3 class="mt-3 text-muted">No Recent Activity</h3>
                        <p class="text-muted">You haven't studied any words in this period.</p>
                        <div class="mt-4">
                            <a href="/flashcards" class="btn btn-primary me-2">
                                <i class="fas fa-cards-blank"></i> Start Flashcards
                            </a>
                            <a href="/ai-learning" class="btn btn-outline-primary">
                                <i class="fas fa-brain"></i> AI Learning
                            </a>
                        </div>
                    </div>
                `;
                return;
            }

            const wordsHtml = words.map(word => {
                const progressPercentage = (word.mastery_level / 3 * 75.4).toFixed(1);
                const masteryClass = word.mastery_level_name.toLowerCase();
                
                return `
                    <div class="col-md-6 col-lg-4 mb-3">
                        <div class="card word-card h-100">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-start mb-2">
                                    <h5 class="card-title mb-0">${word.word}</h5>
                                    <span class="badge mastery-${masteryClass} mastery-badge">
                                        ${word.mastery_level_name}
                                    </span>
                                </div>
                                
                                <p class="card-text text-muted mb-2">${word.definition}</p>
                                
                                <div class="d-flex align-items-center mb-2">
                                    <svg class="progress-ring">
                                        <circle class="background" />
                                        <circle class="progress" style="stroke-dasharray: ${progressPercentage} 75.4;" />
                                    </svg>
                                    <small class="text-muted">
                                        Reviewed ${word.review_count} time${word.review_count !== 1 ? 's' : ''}
                                    </small>
                                </div>
                                
                                <div class="d-flex justify-content-between align-items-center">
                                    <small class="text-muted">
                                        <i class="fas fa-calendar"></i> 
                                        Last: ${word.last_reviewed_date}
                                    </small>
                                    <div class="btn-group btn-group-sm">
                                        <button class="btn btn-outline-primary btn-sm" onclick="reviewWord('${word.word}')">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button class="btn btn-outline-success btn-sm" onclick="practiceWord('${word.word}')">
                                            <i class="fas fa-dumbbell"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            container.innerHTML = `<div class="row">${wordsHtml}</div>`;
        }

        function loadAchievements() {
            const content = document.getElementById('achievements-content');
            content.innerHTML = `
                <div class="text-center">
                    <i class="fas fa-spinner fa-spin fa-2x"></i>
                    <p class="mt-2">Loading achievements...</p>
                </div>
            `;
            
            achievementsModal.show();
            
            fetch('/api/user/achievements')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        displayAchievements(data.achievements);
                    } else {
                        content.innerHTML = `
                            <div class="alert alert-danger">
                                <i class="fas fa-exclamation-triangle"></i>
                                Failed to load achievements: ${data.error}
                            </div>
                        `;
                    }
                })
                .catch(error => {
                    content.innerHTML = `
                        <div class="alert alert-danger">
                            <i class="fas fa-exclamation-triangle"></i>
                            Error loading achievements: ${error.message}
                        </div>
                    `;
                });
        }

        function displayAchievements(achievements) {
            const content = document.getElementById('achievements-content');
            
            if (achievements.length === 0) {
                content.innerHTML = `
                    <div class="text-center py-4">
                        <i class="fas fa-trophy text-muted" style="font-size: 3rem;"></i>
                        <h5 class="mt-3 text-muted">No Achievements Yet</h5>
                        <p class="text-muted">Keep studying to unlock your first achievement!</p>
                    </div>
                `;
                return;
            }

            const achievementsHtml = achievements.map(achievement => `
                <div class="card mb-3">
                    <div class="card-body">
                        <div class="row align-items-center">
                            <div class="col-2 text-center">
                                <i class="fas fa-trophy text-warning" style="font-size: 2rem;"></i>
                            </div>
                            <div class="col-10">
                                <h6 class="card-title mb-1">${achievement.title}</h6>
                                <p class="card-text text-muted mb-1">${achievement.description}</p>
                                <small class="text-success">
                                    <i class="fas fa-calendar-check"></i>
                                    Unlocked: ${achievement.achieved_date}
                                </small>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');

            content.innerHTML = achievementsHtml;
        }

        function loadInsights() {
            const content = document.getElementById('insights-content');
            content.innerHTML = `
                <div class="text-center">
                    <i class="fas fa-spinner fa-spin fa-2x"></i>
                    <p class="mt-2">Loading insights...</p>
                </div>
            `;
            
            insightsModal.show();
            
            fetch('/api/user/insights')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        displayInsights(data.insights);
                    } else {
                        content.innerHTML = `
                            <div class="alert alert-danger">
                                <i class="fas fa-exclamation-triangle"></i>
                                Failed to load insights: ${data.error}
                            </div>
                        `;
                    }
                })
                .catch(error => {
                    content.innerHTML = `
                        <div class="alert alert-danger">
                            <i class="fas fa-exclamation-triangle"></i>
                            Error loading insights: ${error.message}
                        </div>
                    `;
                });
        }

        function displayInsights(insights) {
            const content = document.getElementById('insights-content');
            
            let html = '';

            // Struggling words section
            if (insights.struggling_words && insights.struggling_words.length > 0) {
                html += `
                    <div class="mb-4">
                        <h6><i class="fas fa-exclamation-triangle text-warning"></i> Words Needing Attention</h6>
                        <div class="row">
                `;
                
                insights.struggling_words.forEach(word => {
                    html += `
                        <div class="col-md-6 mb-2">
                            <div class="card border-warning">
                                <div class="card-body py-2">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <strong>${word.word}</strong>
                                            <small class="text-muted d-block">${word.definition}</small>
                                        </div>
                                        <span class="badge bg-warning text-dark">
                                            ${word.incorrect_count} errors
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                html += '</div></div>';
            }

            // Progress trends
            if (insights.progress_trend) {
                html += `
                    <div class="mb-4">
                        <h6><i class="fas fa-chart-line text-info"></i> Progress Trends</h6>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="text-center">
                                    <h4 class="text-primary">${insights.progress_trend.total_words || 0}</h4>
                                    <small class="text-muted">Total Words</small>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="text-center">
                                    <h4 class="text-success">${insights.progress_trend.recent_reviews || 0}</h4>
                                    <small class="text-muted">Recent Reviews</small>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="text-center">
                                    <h4 class="text-info">${Math.round(insights.progress_trend.accuracy_rate * 100) || 0}%</h4>
                                    <small class="text-muted">Accuracy Rate</small>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            if (html === '') {
                html = `
                    <div class="text-center py-4">
                        <i class="fas fa-chart-line text-muted" style="font-size: 3rem;"></i>
                        <h5 class="mt-3 text-muted">No Insights Available</h5>
                        <p class="text-muted">Study more words to generate personalized insights!</p>
                    </div>
                `;
            }

            content.innerHTML = html;
        }

        function reviewWord(word) {
            // Simple word review - show alert with definition
            alert(`Reviewing: ${word}\n\nFor full review features, use the Flashcards or AI Learning modes.`);
        }

        function practiceWord(word) {
            // Redirect to AI learning with focus on this word
            window.location.href = `/ai-learning?focus=${encodeURIComponent(word)}`;
        }
    </script>
</body>
</html>